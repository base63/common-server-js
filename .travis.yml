language: node_js

node_js:
- "node"

cache:
  directories:
  - node_modules

env:
  global:
  - GEMFURY_USER=base63
  # GEMFURY_API_KEY
  secure: "Ew2R941nFOlkugxJeobjfMOSVh42h8xgc2UHox7rRGKLrejP+eUfQa9EbmS9+FLB84btyU+pGw6NiIDeM0s5Q6Wagw2BBjLXWGtGaZAg1NVnGny6V3G0HuZefhT4/whrGT6xX4djSPLpn+p49ZbfOvBOI0PWXD3XzFmoT7EwLiRkC6ZI+luNtLUP1C4L84hkv3fDIp6rIlLryK2jucTVIoO1cu8vMl58MP72JEZuyC6pCNbejLw0n+g5VMFZmFcIhRN8HTlHMKCKNE73CuQtpphGC/O0kxdbR54o2S3+lQ6IBsYUZD4shn0f5dTgBS7+06Dm83dmSTCl/hBG7NLLasXHvmxXljVORzUXL0BApMegP2Rais+7R+7vB6fGQvk6MUW+4ehFMsyra3hPwX8qDTcglWyaPvV+qNVJ2lO9Mh4sD0cWZdbMxE8cwfbg9CY2TmOTVucfK9xIzqXTr7mql+NYa/hMQkOorHQlSP6J91Mo6mvC+3x/5Gj6tPJWD4d809GKId3vhuWsEcYsbWKfmLBKR2mLezvxt5+Q2NT0mUMuerUfP24gdnEXw59eSGSrjehEL1U8yETni2H2g2j27O2J5NBNjO386EdspmfASJ8hH7FJwSZRdqU1cS0qFJ7y0j8jj/787kSuN5el53TTrju5Ymqncx0Gx3MHDLlyw+4="

install:
- npm install --registry=https://npm-proxy.fury.io/${GEMFURY_API_KEY}/${GEMFURY_USER}/ --progress=false

script:
- npm run test

after_success:
- npm run push-coverage-to-codecov

deploy:
- provider: script
  skip_cleanup: true
  script: $(npm bin)/togemfury --user ${GEMFURY_USER} --api_key ${GEMFURY_API_KEY}
  on:
    tags: true
